<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/components/models-table-server-paginated.js - ember-models-table</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="ember-models-table" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.0.0-beta.1.91677698</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Components.GroupSummaryRow.html">Components.GroupSummaryRow</a></li>
                                <li><a href="../classes/Components.ModelsTable.html">Components.ModelsTable</a></li>
                                <li><a href="../classes/Components.ModelsTableCell.html">Components.ModelsTableCell</a></li>
                                <li><a href="../classes/Components.ModelsTableCellColumnSummary.html">Components.ModelsTableCellColumnSummary</a></li>
                                <li><a href="../classes/Components.ModelsTableCellContentDisplay.html">Components.ModelsTableCellContentDisplay</a></li>
                                <li><a href="../classes/Components.ModelsTableCellContentEdit.html">Components.ModelsTableCellContentEdit</a></li>
                                <li><a href="../classes/Components.ModelsTableCellEditToggle.html">Components.ModelsTableCellEditToggle</a></li>
                                <li><a href="../classes/Components.ModelsTableColumnsDropdown.html">Components.ModelsTableColumnsDropdown</a></li>
                                <li><a href="../classes/Components.ModelsTableColumnsHidden.html">Components.ModelsTableColumnsHidden</a></li>
                                <li><a href="../classes/Components.ModelsTableDataGroupBySelect.html">Components.ModelsTableDataGroupBySelect</a></li>
                                <li><a href="../classes/Components.ModelsTableFooter.html">Components.ModelsTableFooter</a></li>
                                <li><a href="../classes/Components.ModelsTableGlobalFilter.html">Components.ModelsTableGlobalFilter</a></li>
                                <li><a href="../classes/Components.ModelsTableGroupedHeader.html">Components.ModelsTableGroupedHeader</a></li>
                                <li><a href="../classes/Components.ModelsTableNoData.html">Components.ModelsTableNoData</a></li>
                                <li><a href="../classes/Components.ModelsTablePageSizeSelect.html">Components.ModelsTablePageSizeSelect</a></li>
                                <li><a href="../classes/Components.ModelsTablePaginationNumeric.html">Components.ModelsTablePaginationNumeric</a></li>
                                <li><a href="../classes/Components.ModelsTablePaginationSimple.html">Components.ModelsTablePaginationSimple</a></li>
                                <li><a href="../classes/Components.ModelsTableRow.html">Components.ModelsTableRow</a></li>
                                <li><a href="../classes/Components.ModelsTableRowExpand.html">Components.ModelsTableRowExpand</a></li>
                                <li><a href="../classes/Components.ModelsTableRowFiltering.html">Components.ModelsTableRowFiltering</a></li>
                                <li><a href="../classes/Components.ModelsTableRowFilteringCell.html">Components.ModelsTableRowFilteringCell</a></li>
                                <li><a href="../classes/Components.ModelsTableRowGrouping.html">Components.ModelsTableRowGrouping</a></li>
                                <li><a href="../classes/Components.ModelsTableRowGroupToggle.html">Components.ModelsTableRowGroupToggle</a></li>
                                <li><a href="../classes/Components.ModelsTableRowSorting.html">Components.ModelsTableRowSorting</a></li>
                                <li><a href="../classes/Components.ModelsTableRowSortingCell.html">Components.ModelsTableRowSortingCell</a></li>
                                <li><a href="../classes/Components.ModelsTableSelect.html">Components.ModelsTableSelect</a></li>
                                <li><a href="../classes/Components.ModelsTableServerPaginated.html">Components.ModelsTableServerPaginated</a></li>
                                <li><a href="../classes/Components.ModelsTableSummary.html">Components.ModelsTableSummary</a></li>
                                <li><a href="../classes/Components.ModelsTableTable.html">Components.ModelsTableTable</a></li>
                                <li><a href="../classes/Components.ModelsTableTableBody.html">Components.ModelsTableTableBody</a></li>
                                <li><a href="../classes/Components.ModelsTableTableFooter.html">Components.ModelsTableTableFooter</a></li>
                                <li><a href="../classes/Components.ModelsTableTableHeader.html">Components.ModelsTableTableHeader</a></li>
                                <li><a href="../classes/Mixins.HoverSupport.html">Mixins.HoverSupport</a></li>
                                <li><a href="../classes/Mixins.Noop.html">Mixins.Noop</a></li>
                                <li><a href="../classes/Themes.Bootstrap3.html">Themes.Bootstrap3</a></li>
                                <li><a href="../classes/Themes.Bootstrap4.html">Themes.Bootstrap4</a></li>
                                <li><a href="../classes/Themes.Default.html">Themes.Default</a></li>
                                <li><a href="../classes/Themes.EmberBootstrap.html">Themes.EmberBootstrap</a></li>
                                <li><a href="../classes/Themes.EmberSemanticUI.html">Themes.EmberSemanticUI</a></li>
                                <li><a href="../classes/Themes.SemanticUI.html">Themes.SemanticUI</a></li>
                                <li><a href="../classes/Utils.ModelsTableColumn.html">Utils.ModelsTableColumn</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: addon/components/models-table-server-paginated.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import {layout as templateLayout} from &#x27;@ember-decorators/component&#x27;;
import {action, computed, setProperties, set, get} from &#x27;@ember/object&#x27;;
import {alias} from &#x27;@ember/object/computed&#x27;;
import {isBlank, isNone} from &#x27;@ember/utils&#x27;;
import {run} from &#x27;@ember/runloop&#x27;;
import {warn} from &#x27;@ember/debug&#x27;;
import ModelsTable from &#x27;./models-table&#x27;;
import layout from &#x27;../templates/components/models-table&#x27;;

/**
 * Table-component with pagination, sorting and filtering.
 *
 * It should be used when pagination, filtering and sorting are done on the server-side. Otherwise [models-table](Components.ModelsTable.html) should be used.
 *
 * This component extends the base models-table component. For the end user, it can be used (nearly) the same:
 *
 * &#x60;&#x60;&#x60;hbs
 * &lt;ModelsTableServerPaginated @data={{data}} @columns={{columns}} /&gt;
 * &#x60;&#x60;&#x60;
 *
 * Usage with block context:
 *
 * &#x60;&#x60;&#x60;hbs
 * &lt;ModelsTableServerPaginated @data={{data}} @columns={{columns}} as |MT|&gt;
 *   &lt;MT.GlobalFilter /&gt;
 *   &lt;MT.ColumnsDropdown /&gt;
 *   &lt;MT.Table /&gt;
 *   &lt;MT.Footer /&gt;
 * &lt;/ModelsTable&gt;
 * &#x60;&#x60;&#x60;
 *
 * ModelsTableServerPaginated yields references to the following contextual components:
 *
 * * [models-table/global-filter](Components.ModelsTableGlobalFilter.html) - global filter used for table data
 * * [models-table/columns-dropdown](Components.ModelsTableColumnsDropdown.html) - dropdown with list of options to toggle columns and column-sets visibility
 * * [models-table/table](Components.ModelsTableTable.html) - table with a data
 * * [models-table/footer](Components.ModelsTableFooter.html) - summary and pagination
 *
 * Check own docs for each component to get detailed info.
 *
 * ModelsTableServerPaginated has a lot of options you may configure, but there are two required properties called &#x60;data&#x60; and &#x60;columns&#x60;. First one contains data-query:
 *
 * &#x60;&#x60;&#x60;js
 * model: function() {
 *  return this.store.query(&#x27;my-model&#x27;, {});
 * }
 * &#x60;&#x60;&#x60;
 *
 * It will then take this query and extend it with pagination, sorting and filtering information. All other query parameters added in will remain untouched. Everything else works exactly the same - global filters, column filters etc. still use the same properties to control them. A few things to notice:
 *
 * - When using &#x60;filterWithSelect&#x60; for a column, you must use &#x60;predefinedFilterOptions&#x60;, because the automatic loading of possible filter values cannot work here.
 * - There is a new optional field &#x60;filteredBy&#x60; for columns, which works much like &#x60;sortedBy&#x60;: if set, this field will be used as query parameter, otherwise it will use the &#x60;propertyName&#x60;.
 * - Sorting will not use multipleColumnSorting, it will only sort by one column.
 * - If you set &#x60;sortedBy: false&#x60; on a column, sorting will be disabled for this column.
 *
 * There are a couple of things which can be configured to adapt to your API:
 *
 * &#x60;&#x60;&#x60; js
 * // The property on meta to load the pages count from.
 * metaPagesCountProperty: &#x27;pagesCount&#x27;,
 *
 * // The property on meta to load the total item count from.
 * metaItemsCountProperty: &#x27;itemsCount&#x27;,
 *
 * // The time to wait until new data is actually loaded.
 * // This can be tweaked to avoid making too many server requests.
 * debounceDataLoadTime: 500,
 *
 * // The query parameters to use for server side filtering / querying.
 * filterQueryParameters: {
 *   globalFilter: &#x27;search&#x27;,
 *   sort: &#x27;sort&#x27;,
 *   sortDirection: &#x27;sortDirection&#x27;,
 *   page: &#x27;page&#x27;,
 *   pageSize: &#x27;pageSize&#x27;
 * },
 &#x60;&#x60;&#x60;
 *
 * This default configuration would try to get the total page count from &#x60;model.get(&#x27;meta.pagesCount&#x27;)&#x60; and the total item count from &#x60;model.get(&#x27;meta.itemsCount&#x27;)&#x60;, and would then go on to build the following query:
 *
 * &#x60;&#x60;&#x60; js
 * columns: [
 *   {
 *     propertyName: &#x27;name&#x27;,
 *     filteredBy: &#x27;model_name&#x27;
 *   }
 * ]
 *
 * // after searching globally for &quot;searchtexthere&quot;
 * // and in the name column for &quot;filterforname&quot;,
 * // and going to page 2,
 * // the following query would be built:
 * ?page=2&amp;pageSize=50&amp;search=searchtexthere&amp;sort=name&amp;sortDirection=ASC&amp;model_name=filterforname
 * &#x60;&#x60;&#x60;
 *
 * @class ModelsTableServerPaginated
 * @namespace Components
 * @extends Components.ModelsTable
 */
@templateLayout(layout)
export default class ModelsTableServerPaginated extends ModelsTable {
  /**
   * True if data is currently being loaded from the server.
   * Can be used in the template to e.g. display a loading spinner.
   *
   * @type boolean
   * @property isLoading
   * @default false
   * @private
   */
  isLoading = false;

  /**
   * True if last data query promise has been rejected.
   * Can be used in the template to e.g. indicate stale data or to e.g. show error state.
   *
   * @type boolean
   * @property isError
   * @default false
   * @private
   */
  isError = false;

  /**
   * The property on meta to load the pages count from.
   *
   * @type string
   * @property metaPagesCountProperty
   * @default &#x27;pagesCount&#x27;
   */
  metaPagesCountProperty = &#x27;pagesCount&#x27;;
  /**
   * The property on meta to load the total item count from.
   *
   * @type {string}
   * @property metaItemsCountProperty
   * @default &#x27;itemsCount&#x27;
   */
  metaItemsCountProperty = &#x27;itemsCount&#x27;;

  /**
   * The time to wait until new data is actually loaded.
   * This can be tweaked to avoid making too many server requests.
   *
   * @type number
   * @property debounceDataLoadTime
   * @default 500
   */
  debounceDataLoadTime = 500;

  /**
   * Determines if multi-columns sorting should be used
   *
   * @type boolean
   * @property multipleColumnsSorting
   * @default false
   */
  multipleColumnsSorting = false;

  /**
   * The query parameters to use for server side filtering / querying.
   *
   * @type object
   * @property filterQueryParameters
   */
  filterQueryParameters = {
    globalFilter: &#x27;search&#x27;,
    sort: &#x27;sort&#x27;,
    sortDirection: &#x27;sortDirection&#x27;,
    page: &#x27;page&#x27;,
    pageSize: &#x27;pageSize&#x27;
  };

  /**
   * @property observedProperties
   * @type string[]
   * @private
   */

  observedProperties = [&#x27;currentPageNumber&#x27;, &#x27;sortProperties.[]&#x27;, &#x27;pageSize&#x27;, &#x27;filterString&#x27;, &#x27;processedColumns.@each.filterString&#x27;];

  /**
   * This is set during didReceiveAttr and whenever the page/filters change.
   *
   * @override
   * @property filteredContent
   * @default []
   * @private
   * @type object[]
   */
  filteredContent = null;

  /**
   * For server side filtering, visibleContent is same as the filtered content
   *
   * @override
   * @property visibleContent
   * @private
   * @type object[]
   */
  @alias(&#x27;arrangedContent&#x27;) visibleContent;

  /**
   * For server side filtering, arrangedContent is same as the filtered content
   *
   * @override
   * @property arrangedContent
   * @private
   * @type object[]
   */
  @alias(&#x27;filteredContent&#x27;) arrangedContent;

  /**
   * The total content length is get from the meta information.
   * Set metaItemsCountProperty to change from which meta property this is loaded.
   *
   * @override
   * @type number
   * @property arrangedContentLength
   * @private
   */
  @computed(&#x27;filteredContent.meta&#x27;)
  get arrangedContentLength() {
    let itemsCountProperty = get(this, &#x27;metaItemsCountProperty&#x27;);
    let meta = get(this, &#x27;filteredContent.meta&#x27;) || {};
    return get(meta, itemsCountProperty) || 0;
  }

  /**
   * The pages count is get from the meta information.
   * Set metaPagesCountProperty to change from which meta property this is loaded.
   *
   * @type number
   * @property pagesCount
   * @override
   * @private
   */
  @computed(&#x27;filteredContent.meta&#x27;)
  get pagesCount() {
    let pagesCountProperty = get(this, &#x27;metaPagesCountProperty&#x27;);
    let meta = get(this, &#x27;filteredContent.meta&#x27;) || {};
    return get(meta, pagesCountProperty) || 1;
  }

  /**
   * The index of the last item that is currently being shown.
   *
   * @type number
   * @property lastIndex
   * @override
   * @private
   */
  @computed(&#x27;pageSize&#x27;, &#x27;currentPageNumber&#x27;, &#x27;arrangedContentLength&#x27;)
  get lastIndex() {
    let pageMax = parseInt(get(this, &#x27;pageSize&#x27;), 10) * get(this, &#x27;currentPageNumber&#x27;);
    let itemsCount = get(this, &#x27;arrangedContentLength&#x27;);
    return Math.min(pageMax, itemsCount);
  }

  /**
   * This function actually loads the data from the server.
   * It takes the store, modelName and query from the passed in data-object and adds page, sorting &amp; filtering to it.
   *
   * @returns {Promise}
   * @method _loadData
   * @private
   */
  _loadData() {
    let data = get(this, &#x27;data&#x27;);
    let currentPageNumber = get(this, &#x27;currentPageNumber&#x27;);
    let pageSize = get(this, &#x27;pageSize&#x27;);
    let columns = get(this, &#x27;processedColumns&#x27;);
    let sortProperties = get(this, &#x27;sortProperties&#x27;);
    let filterString = get(this, &#x27;filterString&#x27;);

    if (!get(data, &#x27;query&#x27;)) {
      warn(&#x27;You must use http://emberjs.com/api/data/classes/DS.Store.html#method_query for loading data&#x27;, false, {id: &#x27;#emt-query-usage&#x27;});
      return;
    }
    let query = Object.assign({}, get(data, &#x27;query&#x27;));
    let store = get(data, &#x27;store&#x27;);
    let modelName = get(data, &#x27;type.modelName&#x27;);

    // Add pagination information
    query[get(this, &#x27;filterQueryParameters.page&#x27;)] = currentPageNumber;
    query[get(this, &#x27;filterQueryParameters.pageSize&#x27;)] = pageSize;
    // Add sorting information
    if (sortProperties &amp;&amp; get(sortProperties, &#x27;length&#x27;)) {
      if (get(this, &#x27;multipleColumnsSorting&#x27;)) {
        query = this.multipleColumnsSortingWrapper(query, sortProperties);
      }
      else {
        if (sortProperties[0]) {
          let [sortBy, sortDirection] = sortProperties[0].split(&#x27;:&#x27;);
          query = this.singleColumnSortingWrapper(query, sortBy, sortDirection.toUpperCase());
        }
      }
    } else {
      delete query[[get(this, &#x27;filterQueryParameters.sort&#x27;)]];
      delete query[[get(this, &#x27;filterQueryParameters.sortDirection&#x27;)]];
    }

    // Add global filter
    let globalFilter = get(this, &#x27;filterQueryParameters.globalFilter&#x27;);
    if (filterString) {
      query[globalFilter] = filterString;
    } else {
      delete query[globalFilter];
    }

    // Add per-column filter
    if (get(this, &#x27;useFilteringByColumns&#x27;)) {
      columns.forEach(column =&gt; {
        let filter = get(column, &#x27;filterString&#x27;);
        let filterTitle = this.getCustomFilterTitle(column);
        this.setQueryFilter(query, column, filterTitle, filter);
      });
    }

    setProperties(this, {isLoading: true, isError: false});
    return this.doQuery(store, modelName, query)
      .then(() =&gt; setProperties(this, {isLoading: false, isError: false}))
      .catch(() =&gt; setProperties(this, {isLoading: false, isError: true}));
  }

  /**
   * Do query-request to load new data
   *
   * You may override this method to add some extra behavior or even additional requests
   *
   * @method doQuery
   * @param {object} store
   * @param {string} modelName
   * @param {object} query
   * @returns {Promise}
   */
  doQuery(store, modelName, query) {
    return store.query(modelName, query).then(newData =&gt; set(this, &#x27;filteredContent&#x27;, newData));
  }

  /**
   * Actually set the filter on a query.
   * This can be overwritten for special case handling.
   * Note that this will mutate the given query object!
   *
   * @param {object} query the query to mutate
   * @param {object} column the column that is filtering
   * @param {string} filterTitle the query param name for filtering
   * @param {*} filter the actual filter value
   * @returns {undefined}
   * @method setQueryFilter
   */
  setQueryFilter(query, column, filterTitle, filter) {
    if (!isBlank(filter)) {
      query[filterTitle] = filter;
    } else {
      delete query[filterTitle];
    }
  }

  /**
   * Wrapper for sorting query when single column sorting is used
   *
   * @param {object} query parameters
   * @param {string} sortBy
   * @param {string} sortDirection
   * @returns {object} query parameters
   * @method singleColumnSortingWrapper
   */
  singleColumnSortingWrapper(query, sortBy, sortDirection) {
    query[get(this, &#x27;filterQueryParameters.sort&#x27;)] = sortBy;
    query[get(this, &#x27;filterQueryParameters.sortDirection&#x27;)] = sortDirection;

    return query;
  }

  /**
   * Wrapper for sorting query when multi columns sorting is used
   *
   * @param {object} query
   * @param {object} sortProperties
   * @returns {object} query parameters
   * @method multipleColumnsSortingWrapper
   */
  multipleColumnsSortingWrapper(query, sortProperties) {
    query[get(this, &#x27;filterQueryParameters.sort&#x27;)] = sortProperties.map(sortProp =&gt; {
      const [prop, direction] = sortProp.split(&#x27;:&#x27;);
      const sign = direction.toLowerCase() === &#x27;desc&#x27; ? &#x27;-&#x27; : &#x27;&#x27;;
      return &#x60;${sign}${prop}&#x60;;
    }).join(&#x27;,&#x27;);

    return query;
  }

  /**
   * Customize filter title
   *
   * @method getCustomFilterTitle
   * @param {object} column
   * @returns {string} title
   */
  getCustomFilterTitle(column) {
    return get(column, &#x27;filteredBy&#x27;) || get(column, &#x27;propertyName&#x27;);
  }

  /**
   * @override
   * @method actions.sort
   * @param {ModelsTableColumn} column
   * @returns {undefined}
   */
  @action
  sort(column) {
    const sortMap = get(this, &#x27;sortMap&#x27;);
    let sortedBy = get(column, &#x27;sortedBy&#x27;) || get(column, &#x27;propertyName&#x27;);
    if (isNone(sortedBy)) {
      return;
    }
    let currentSorting = get(column, &#x27;sorting&#x27;);
    let newSorting = sortMap[currentSorting.toLowerCase()];
    let sortingArgs = [column, sortedBy, newSorting];
    if (get(this, &#x27;multipleColumnsSorting&#x27;)) {
      this._multiColumnsSorting(...sortingArgs);
    }
    else {
      this._singleColumnSorting(...sortingArgs);
    }
    this.userInteractionObserver();
  }

  didReceiveAttrs() {
    set(this, &#x27;filteredContent&#x27;, get(this, &#x27;data&#x27;));
  }

  _addPropertyObserver() {
    run.debounce(this, this._loadData, get(this, &#x27;debounceDataLoadTime&#x27;));
  }

  willInsertElement() {
    super.willInsertElement(...arguments);
    let observedProperties = get(this, &#x27;observedProperties&#x27;);
    observedProperties.forEach(propertyName =&gt; this.addObserver(propertyName, this, &#x27;_addPropertyObserver&#x27;));
  }

  willDestroyElement() {
    super.willDestroyElement(...arguments);
    let observedProperties = get(this, &#x27;observedProperties&#x27;);
    observedProperties.forEach(propertyName =&gt; this.removeObserver(propertyName, this, &#x27;_addPropertyObserver&#x27;));
  }
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
